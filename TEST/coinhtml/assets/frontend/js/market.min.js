"use strict";!function(e,t,n,r,o){var a={elements:{table:null,thead:null,tbody:null,search:null,clear_btn:null,more_btn:null,order_select:null},query:[],index:null,current_order:{by:r.order.by,desc:r.order.desc},count_rows:null,rows_maps:{},init:function(){var t=this.elements;t.thead=t.table.find("thead"),t.tbody=t.table.find("tbody"),this.resetIndex(),t.tbody.on("click","tr",function(){var t=e(this).data("id");window.location.href=o.currency_page+t}),t.tbody.find("> tr").each(function(){var t=e(this),n=t.data("code");a.rows_maps[n]||(a.rows_maps[n]={traded:!1,tr:t}),a.count_rows++}),t.search.find(".search").dropdown({forceSelection:!1,onAdd:function(e){a.searchAdd(e)},onRemove:function(e){a.searchRemove(e)}}),t.clear_btn.click(function(){a.searchClear()}),t.thead.find("> tr > th").click(function(){var t=e(this),n=t.data("column"),r=a.current_order.by!==n||!a.current_order.desc,o="name"===n?"string":"number";a.orderTable(n,o,r),a.updateNameImages()}),t.order_select.dropdown({forceSelection:!1,onChange:function(e){var t=e.substr(1),n="-"===e[0],r="name"===t?"string":"number";a.orderTable(t,r,n)}}),t.more_btn&&t.more_btn.click(function(){a.incIndex(),a.showIndexRows(),a.updateNameImages(),a.index>=a.count_rows-1?t.more_btn.hide():t.more_btn.show()}),this.setColumnIcon(this.current_order.by,this.current_order.desc),this.updateNameImages(),e(document).on("fxready",function(){a.connectCoinCap()})},resetIndex:function(){this.index=99},incIndex:function(){this.index+=100},updateNameImages:function(){this.elements.tbody.find("> tr:not(:hidden) > td.col-name > .header > img").each(function(){var t=e(this);t.attr("src",t.data("source")||r.placeholder)})},setColumnIcon:function(e,t){var n=t?'<i class="caret down icon"></i>':'<i class="caret up icon"></i>',r=this.elements.thead.find("> tr > th.col-"+e+" > span");this.elements.thead.find("> tr > th > span").empty(),r.html(n)},orderTable:function(t,n,r){var o=this.elements.tbody,d=o.find("> tr"),i=e.makeArray(d),s=r?-1:1,c=r?1:-1,l="string"===n?function(n,r){var o=e(n).find("> td.col-"+t).data("value")||"",a=e(r).find("> td.col-"+t).data("value")||"";return o=o.toLowerCase(),a=a.toLowerCase(),o===a?0:o>a?s:c}:function(n,r){var o=parseFloat(e(n).find("> td.col-"+t).data("value")),a=parseFloat(e(r).find("> td.col-"+t).data("value"));return isNaN(o)&&(o=Number.NEGATIVE_INFINITY),isNaN(a)&&(a=Number.NEGATIVE_INFINITY),o===a?0:o>a?s:c};i.sort(l),this.setColumnIcon(t,r),o.html(i),this.isSearching()||(this.resetIndex(),this.showIndexRows()),a.current_order.by=t,a.current_order.desc=r},showIndexRows:function(){this.elements.tbody.find("> tr").each(function(t,n){var r=e(this);t<=a.index?r.show():r.hide()})},isSearching:function(){return this.query.length>0},findByCode:function(e){return this.elements.tbody.find('tr[data-code="'+e+'"]')},searchAdd:function(e){var t=this.query,n=this.elements.tbody;if(t.indexOf(e)===-1){0===t.length&&n.find("> tr:not(:hidden)").hide(),t.push(e);var o=a.findByCode(e).show(),d=o.find("> td.name > .header > img");d.attr("src",d.data("source")||r.placeholder)}},searchRemove:function(e){var t=this.query,n=t.indexOf(e);n!==-1&&(t.splice(n,1),0===t.length?(this.resetIndex(),this.showIndexRows(),this.updateNameImages()):this.findByCode(e).hide())},searchClear:function(){this.elements.search.find(".search").dropdown("restore defaults")},connectCoinCap:function(){t.connect("https://coincap.io").on("trades",function(e){var t=e.coin,r=e.msg.price;if(o.price_currency!==t){var d=a.rows_maps[t];if(d){var i=d.tr;if("none"!==i.css("display")&&!d.traded){d.traded=!0,i.addClass("traded");var s=i.find("> td.col-price");s.length&&s.find("> .col-value").text(n._priceFormat(n(r).from("USD").to(o.price_currency)));var c=i.find("> td.col-market_cap"),l=i.data("available");if(c.length&&l){var u=n(r*l).from("USD").to(o.price_currency);if(u){var h=u.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",");c.find("> .col-value").text(h)}}setTimeout(function(){d.traded=!1,i.removeClass("traded")},1e3)}}}})}};e(function(){a.elements.table=e("#market-table"),a.elements.search=e("#market-search"),a.elements.clear_btn=e("#market-search-clear-btn"),a.elements.more_btn=e("#market-more-btn"),a.elements.order_select=e("#market-order-select"),a.init()})}(jQuery,io,fx,window.MARKET_DATA,window.CoinTableConstants);